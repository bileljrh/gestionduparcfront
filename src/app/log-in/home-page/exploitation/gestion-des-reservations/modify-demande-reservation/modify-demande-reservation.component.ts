import {Component, Inject} from '@angular/core';
import {ReservationVehiculeTableData} from '../reservation-vehicule-table-data';
import {FormControl, FormGroup, Validators} from '@angular/forms';
import {MAT_DIALOG_DATA, MatDialogRef} from '@angular/material/dialog';
import {ExploitationServiceService} from '../../exploitation-service.service';
import {MatSnackBar} from '@angular/material/snack-bar';
import {NgxUiLoaderService} from 'ngx-ui-loader';
import moment from 'moment';

@Component({
  selector: 'app-modify-demande-reservation',
  templateUrl: './modify-demande-reservation.component.html',
  styleUrls: ['./modify-demande-reservation.component.scss'],
  providers: [MatSnackBar]
})
export class ModifyDemandeReservationComponent {
  modifiedReservation: ReservationVehiculeTableData = {
    id: null,
    dateDebutReservation: '',
    dateFinReservation: '',
    objet: ''
  };
  modifiedReservationForm = new FormGroup({
    dateDebut: new FormControl(null, Validators.required),
    dateFin: new FormControl(null, Validators.required),
    objet: new FormControl(null),
  });
  structure = '';

  constructor(public dialogRef: MatDialogRef<ModifyDemandeReservationComponent>, @Inject(MAT_DIALOG_DATA) public data, private Exploitation: ExploitationServiceService, private snackBar: MatSnackBar, private ngxLoader: NgxUiLoaderService) {
    console.log(data);
    this.ngxLoader.start();
    this.patchInitialValues();
    this.ngxLoader.stop();
  }

  closeDialog() {
    this.dialogRef.close();
  }

  onCancel() {
    this.dialogRef.close();
  }

  onConfirm() {
    if (this.modifiedReservationForm.valid) {
      this.patchFinalValues();
      this.dialogRef.close(this.modifiedReservation);
    }
  }

  patchInitialValues() {
    this.modifiedReservationForm.controls.dateDebut.patchValue(this.data.element.dateDebutReservation);
    this.modifiedReservationForm.controls.dateFin.patchValue(this.data.element.dateFinReservation);
    this.modifiedReservationForm.controls.objet.patchValue(this.data.element.objet);
  }

  patchFinalValues() {
    this.modifiedReservation = {
      id: this.data.element.id,
      dateDebutReservation: moment(this.modifiedReservationForm.value.dateDebut as Date).format('YYYY-MM-DD'),
      dateFinReservation: moment(this.modifiedReservationForm.value.dateFin as Date).format('YYYY-MM-DD'),
      objet: this.modifiedReservationForm.value.objet
    };
  }


}
